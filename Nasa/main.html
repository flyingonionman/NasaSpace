<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="main.css">
	
<meta name="viewport" content="initial-scale=1.0, width=device-width" />
<link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.0/mapsjs-ui.css?dp-version=1533195059" />
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
<script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
<script src="haha.js"></script>

</head>
<body>
  
<div id="big">
	
	<div id="left" >
	 <div id="map" style="width: 100%; height: 400px; background: grey"></div>
		<div class="subsec" id="sec4">
			<p>
				A Minyoung Na/Hannah Quirk Works
			</p>
		</div>
		
		<div class="subsec" id="sec3">
			<div id="search">Search</div>
			<div id="results">Results</div>
			<p>
				-Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
				sed do eiusmod tempor incididunt ut labore et dolore 
				magna aliqua. Ut enim ad minim veniam, quis nostrud 
				exercitation ullamco laboris nisi ut aliquip ex ea commodo 
				consequat. Duis aute irure dolor in reprehenderit in 
				voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
			</p>
		</div>
		
	</div>
	
	<div id="right" class="closed">
		<img id="arrow" src="Images/arrow.png" >
		<a class="title">DEMETER</a>
		<a class="title" id="flash">DATA x LIFE</a>
		<img id="refugees" src="Images/refugees.jpg" >

		<div class="subsec" id="sec1">
			<a class="title2">What is Demeter ?</a>
			<p>
				-Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
				sed do eiusmod tempor incididunt ut labore et dolore 
				magna aliqua. Ut enim ad minim veniam, quis nostrud 
				exercitation ullamco laboris nisi ut aliquip ex ea commodo 
				consequat. Duis aute irure dolor in reprehenderit in 
				voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
			</p>
		</div>
		
		<div class="subsec" id="sec2">
			<a class="title2">How do we use Demeter ?</a>
				<p>
					-Lorem ipsum dolor sit amet, consectetur adipiscing elit, 
				sed do eiusmod tempor incididunt ut labore et dolore 
				magna aliqua. Ut enim ad minim veniam, quis nostrud 
				exercitation ullamco laboris nisi ut aliquip ex ea commodo 
				consequat. Duis aute irure dolor in reprehenderit in 
				voluptate velit esse cillum dolore eu fugiat nulla pariatur. 
				</p>
		</div>
	</div>
</div>	
	
<div id="bottom">
	<div id="return">Return</div>	
	
	<div id="icon"></div>
	
	<div id="info">
	<p>NUTRITIONAL INFO - 100 grams</p>
	<table style="width:90%">
		
	  <tr>
		<td>Caloric Intake</td>
		<td><data id="calory">xxx</data></td> 
		<td>Fat</td>
		<td><data id="fat">xxxx</data></td>
		</tr>
	  <tr>
		<td>Protein</td>
		<td><data id="protein">xxxx</data></td> 
		<td>Saturated Fat</td>
		<td><data id="sfat">xxxx</data></td> 
	  </tr>
	  <tr>
		<td>Sugar</td>
		<td><data id="sugar">xxxx</data></td> 
		<td>Trans Fat</td>
		<td><data id="tfat">xxxx</data></td> 		  
	  </tr>
      <tr>
		<td>Fibre</td>
		<td><data id="fibre">xxxx</data></td> 
	  </tr>
	</table>
	</div>
	
	<div id ="analysis">
	<p>
	Time until maturity: asdfasdfsadf
	Cost:  sadfsadfasfasdf
	Advice: 	Plant in the autumn and harvest before summer 
		- can be used to make such and such, a staple food in somewhere
	</p>
	</div>	
</div>
	
	
<script  type="text/javascript" charset="UTF-8" >
    
   
/**
 * An event listener is added to listen to tap events on the map.
 * Clicking on the map displays an alert box containing the latitude and longitude
 * of the location pressed.
 * @param  {H.Map} map      A HERE Map instance within the application
 */
function setUpClickListener(map) {
  // Attach an event listener to map display
  // obtain the coordinates and display in an alert box.
  map.addEventListener('tap', function (evt) {
    var coordx = evt.currentPointer.viewportX;
    var coordy = evt.currentPointer.viewportY;
    var coord = map.screenToGeo(coordx,
            coordy);
   //gives NSEW coords
    var realcoord = Math.abs(coord.lat.toFixed(4)) +
        ((coord.lat > 0) ? 'N' : 'S') +
        ' ' + Math.abs(coord.lng.toFixed(4)) +
         ((coord.lng > 0) ? 'E' : 'W');

    alert('Clicked at ' + coord);

    //parses through the data received to get t2m's temperature value
    function reqListener () {
        var now = new Date();
        var nowDate = now.getFullYear()+""+now.getMonth()+""+now.getDay();
        var t2m = this.response.features[0].properties.parameter.T2M;
        //have to turn the returned data into an array and access first item in array to make data readable
		tempstring = String(Object.values(t2m)[0])
        console.log(Object.values(t2m)[0]);
    }
    //creating date variable
    var now = new Date();
    var nowDate = now.getFullYear()+""+now.getMonth()+""+now.getDay();
    console.log(nowDate);
    console.log(coord.lat,coord.lng);
    //requesting information from today @ clicked lat and long thru api
    var urlToRequest =   "https://power.larc.nasa.gov/cgi-bin/v1/DataAccess.py?request=execute&identifier=SinglePoint&parameters=T2M&";
    urlToRequest += "startDate=" + nowDate;
    urlToRequest += "&endDate="+ nowDate;
    urlToRequest += "&userCommunity=SSE&tempAverage=DAILY&outputList=JSON,ASCII&";
    urlToRequest += "lat=" + coord.lat + "&lon=" + coord.lng + "&user=anonymous";

    //allowing us to send request
    var oReq = new XMLHttpRequest();
    oReq.responseType = 'json';
    oReq.addEventListener("load", reqListener);
    oReq.open("GET", urlToRequest);
    oReq.send();

    //PRECIPITATION
    //doing it all again with precipitation
    //parses through the data received to get t2m's temperature value
    function reqListener2 () {
        var now = new Date();
        var dateMin = (now.getFullYear()-1)+""+now.getMonth()+""+now.getDay();
        var dateMax = (now.getFullYear()-1)+""+(now.getMonth()+1)+""+now.getDay();
        var prec = this.response.features[0].properties.parameter.PRECTOT;
        //create average of precips
        var sumprec = 0;
        for (i = 0; i < 20; i++) {
                sumprec+=Object.values(prec)[i];
            }
        var avgprec = sumprec/20;
            //have to turn the returned data into an array and access first item in array to make data readable
        console.log(avgprec);
    }
    //creating date variable
    var now2 = new Date();
        var dateMin = (now2.getFullYear()-1)+""+now2.getMonth()+""+now2.getDay();
        var dateMax = (now2.getFullYear()-1)+""+(now2.getMonth()+1)+""+now2.getDay();
    //requesting information from today @ clicked lat and long thru api
    var urlToRequest2 =   "https://power.larc.nasa.gov/cgi-bin/v1/DataAccess.py?request=execute&identifier=SinglePoint&parameters=PRECTOT&";
    urlToRequest2 += "startDate=" + dateMin;
    urlToRequest2 += "&endDate="+ dateMax;
    urlToRequest2 += "&userCommunity=SSE&tempAverage=DAILY&outputList=JSON,ASCII&";
    urlToRequest2 += "lat=" + coord.lat + "&lon=" + coord.lng + "&user=anonymous";

    //allowing us to send request
    var oReq2 = new XMLHttpRequest();
    oReq2.responseType = 'json';
    oReq2.addEventListener("load", reqListener2);
    oReq2.open("GET", urlToRequest2);
    oReq2.send();


  });
}



/**
 * Boilerplate map initialization code starts below:
 */

//Step 1: initialize communication with the platform
var platform = new H.service.Platform({
  app_id: 'devportal-demo-20180625',
  app_code: '9v2BkviRwi9Ot26kp2IysQ',
  useHTTPS: true
});
var pixelRatio = window.devicePixelRatio || 1;
var defaultLayers = platform.createDefaultLayers({
  tileSize: pixelRatio === 1 ? 256 : 512,
  ppi: pixelRatio === 1 ? undefined : 320
});

//Step 2: initialize a map
var map = new H.Map(document.getElementById('map'),
  defaultLayers.normal.map,{
  center: {lat: 22.532006394195832, lng: 6.191581872655761},
  zoom: 1,
  pixelRatio: pixelRatio
});

//Step 3: make the map interactive
// MapEvents enables the event system
// Behavior implements default interactions for pan/zoom (also on mobile touch environments)
var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

setUpClickListener(map);
</script>
</body>
</html>